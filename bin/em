#!/bin/sh
[ "$1" ] || { echo "$0 [-n] [-s] [-k] [-v]" 1>&2 ; exit 1 ; }

# default is in-terminal editing

while getopts "wskvlzd" opt; do
  case "$opt" in
      n)  # open in window
      shift $((OPTIND-1))
	  exec emacs -nw "$@"
	  ;;
      s)  # [re]start server
	  exec systemctl --user restart emacsd
	  ;;
      k)  # kill server
	  exec systemctl --user stop emacsd
	  ;;
      v)  # show server log
	  exec sudo journalctl --user-unit emacsd -f
	  ;;
      l)  # check server status
	  exec systemctl status --user emacsd
	  ;;
      z)  # edit this script
	  exec emacs $0
	  ;;
      d) # edit service file
	  exec emacs ~/.config/systemd/user/emacsd.service
	  ;;
  esac
done
if wmctrl -m | grep EXWM >/dev/null
then
  # always use exwm if available
  shift $((OPTIND-1))
  exec emacsclient -a emacs -r -n "$@"
fi

shift $((OPTIND-1))
exec emacsclient -c -n -a "" "$@"

